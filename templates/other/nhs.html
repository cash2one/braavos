{% extends "base.html" %}
{% block title %}年会节目评选{% endblock %}

{% block content %}
<style>
    *{padding: 0;
        list-style: none;
        margin:0;
        font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
        }
    h3{text-align: center;
    font-size: 20px;
    margin-top: 10px;
    margin-bottom: 15px;}
    p{font-size: 12px;
        margin-bottom: 10px;
        text-align: center;}
    table{margin:0 auto;width: 800px;height: 40px;line-height: 40px;
        margin-bottom: 10px;}
    table thead tr{background: rgb(184, 204, 228);}

    table thead tr th{text-align: center;}
    table tbody tr td{padding-left: 20px;}
    input.btn{padding: 10px 20px 10px 20px;
            background: rgb(184, 204, 228);
            color:000;
            font-size: 18px;
            display: block;
            margin-top: 10px;
            border:none;
            margin: 0 auto;}
    .progress{background: #f5f5f5;}
</style>
<div class="container" style="min-width: 950px;">
    <h3 style="margin-top: 85px;">2015年年会节目评选表</h3>
    <p>注：每人有三票投选的机会，评选出一二三等奖</p>
    <form action="" style="display:none;">
        <table border="1" cellspacing="0" cellpadding="0" bordercolor="#bdbdbd" >
            <thead>
                <tr>
                    <th></th>
                    <th>序号</th>
                    <th>节目名称</th>
                    <th>类型</th>
                    <th>参与人</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="checkbox" value="1" name="chk" class="select-table" data="1"></td>
                    <td>1</td>
                    <td>《try everthing》</td>
                    <td>开场舞</td>
                    <td>华北媒介部+oscar+盖新</td>
                </tr>
                <tr>
                    <td><input type="checkbox" value="2" name="chk" class="select-table" data="2"></td>
                    <td>2</td>
                    <td>《歌曲串烧》</td>
                    <td>歌曲</td>
                    <td>谢仲、陈超、杨茜</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="3" name="chk" class="select-table" data="3"></td>
                    <td>3</td>
                    <td>《致趣联播》</td>
                    <td>脱口秀</td>
                    <td>华东销售部</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="4" name="chk" class="select-table" data="4"></td>
                    <td>4</td>
                    <td>《我也是歌手》</td>
                    <td>模仿秀+歌曲</td>
                    <td>华南</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="5" name="chk" class="select-table" data="5"></td>
                    <td>5</td>
                    <td>《脱口秀》</td>
                    <td>语言类节目</td>
                    <td>程世民</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="6" name="chk" class="select-table" data="6"></td>
                    <td>6</td>
                    <td>《蒙面歌王》</td>
                    <td>歌曲</td>
                    <td>戴悦、刘懋、郭植、张凯、帅毕敏、陈玲</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="7" name="chk" class="select-table" data="7"></td>
                    <td>7</td>
                    <td>《INAD加油》</td>
                    <td>舞蹈</td>
                    <td>赵利云、张韡、刘莹、谢哲菲、赵小刚、王珊珊</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="8" name="chk" class="select-table" data="8"></td>
                    <td>8</td>
                    <td>《uptown funk》</td>
                    <td>歌曲</td>
                    <td>华东策划部</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="9" name="chk" class="select-table" data="9"></td>
                    <td>9</td>
                    <td>《极限挑战》</td>
                    <td>挑战类</td>
                    <td>鄂婉婷、刘正阳</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="10" name="chk" class="select-table" data="10"></td>
                    <td>10</td>
                    <td>《台前幕后》</td>
                    <td>舞台剧</td>
                    <td>刘双颖、张子越、马妍、董莎莎、梁莹、刘影</td> 
                </tr>
                <tr>
                    <td><input type="checkbox" value="11" name="chk" class="select-table" data="11"></td>
                    <td>11</td>
                    <td>《狐狸说嘛呢》</td>
                    <td>舞蹈</td>
                    <td>华东运营部</td> 
                </tr>
            </tbody>
        </table>
        <input type="button" value="确认" class='btn'>
    </form>
    <div >
    <h3 style="margin-top: 85px;">结果</h3>
    <table border="1" cellspacing="0" cellpadding="0" bordercolor="#bdbdbd" >
        <thead>
                <tr>
                    <th style="width:30%">节目名称</th>
                    <th>结果</th>
                </tr>
            </thead>
            <tbody>
                {% for k in res %}
                <tr>
                    <td>{{k.name}}</td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="{{k.count}}" aria-valuemin="0" aria-valuemax="{{total_count}}" style="width: {{k.percent}}%">
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
    </table>
    </div>
</div>

<script>
    $(document).ready(function(){

         $("input[name='chk']").click(function(){
            chkbox($(this).val()) 
         })
         function chkbox(elm){
            var obj=$("input[name='chk']"); 
            var num=0; 
            for (i=0;i <obj.length ;i++ ){
               if (obj[i].checked ){
                    num+=1;
               } 
               if(num>3){
                alert( "最多只能选择三个！"); 
                obj[i].checked=false; 
                return false; 
               }
                      
            } 
 
        }  

       $('.btn').click(function(){
            var ids = [];
           $("input[name='chk']:checked").each(function() {  
                  ids.push($(this).attr('data'));
              });
            if (ids.length ==3) {
                $.ajax({
                    url:"{{url_for('other.nianhui')}}",
                    method:'POST',
                    data:{'ids':ids.join('|')},
                    success: function(data) {
                        if (data.status == 0) {
                           alert('投票成功')
                        } else {
                           alert(data.msg)
                        }
                    }
                });
            } else if(ids.length>3){
                alert('只有三次投票机会哦！')
            }else if(ids.length<3&& ids.length>0){
                alert('请选择您最心仪的三个节目！')
            }else {
                alert('请选择操作记录！');
            }
       }) 
    })
</script>
{% endblock %}

