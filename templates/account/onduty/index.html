{% extends "/base.html" %}
{% block title %}员工考勤{% endblock %}

{% block content %}
{% include "/account/account_onduty_base.html" %}
  <div class="container bra-box" style="min-width: 950px;">
    <h3>员工考勤</h3>
     {% if g.user.is_HR_leader() or g.user.is_HR() or g.user.is_OPS() or g.user.is_super_leader() %}
    <form method="POST" class="form-inline" enctype="multipart/form-data">
      <div class="form-group">
        <label for="exampleInputName2"></label>
        <input class="file-widget-input hide" type="file" name="file">
      </div>
      <button class="file-widget-btn btn btn-sm btn-primary">上传员工考勤</button>
    </form>
    {% endif %}
    <br/>
    <form class="form-inline">
      <div class="form-group">
        <label for="exampleInputName2">员工姓名</label>
        <input type="text" class="form-control" id="name" name="name" placeholder="员工姓名" value="{{name}}">
      </div>
      <div class="form-group">
        <label for="exampleInputEmail2">区域</label>
        <select class="form-control" id="location" name='location' style="width:150px;">
          <option value='0'>全部</option>
          <option value='1'>华北</option>
          <option value='2'>华东</option>
          <option value='3'>华南</option>
        </select>
      </div>
      <button type="submit" class="btn btn-info">查询</button>
    </form>
    <br/>
    {% if g.user.is_HR_leader() or g.user.is_HR() or g.user.is_OPS() or g.user.is_super_leader() %}
    <form class="form-inline" method="POST">
      <input type='hidden' value="excel" name="action">
      <div class="form-group">
        <label for="exampleInputName2"></label>
        <input type="text" class="datetimepicker form-control" id="start_date" name="start_date" data-date-format="yyyy-mm-dd" value="{{start_date}}">
      </div>
      <div class="form-group">
        <label for="exampleInputEmail2">至</label>
        <input type="text" class="datetimepicker form-control" id="end_date" name="end_date" data-date-format="yyyy-mm-dd" value="{{end_date}}">
      </div>
      <button type="submit" class="btn btn-info">导出考勤</button>
    </form>
    {% endif %}
    <br/>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>员工编号</th>
          <th>姓名</th>
          <th>区域</th>
          <th>最后一次打卡时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <th scope="row">{{user.sn or '无'}}</th>
          <td>{{user.name}}</td>
          <td>{{user.location_cn}}</td>
          <td>{{user.last_check_time}}</td>
          <td><a target="_blank" href="{{url_for('account_onduty.info', uid=user.id)}}">查看</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
</div>
<script>
  $('.file-widget-btn').click(function(e){
    e.preventDefault();
    $(this).parents("form").find('.file-widget-input').click();
  });
  $('.file-widget-input').change(function(e){
    var filename = $(this).val(),
      fileExt = filename.substring(filename.lastIndexOf('.')+1, filename.length);
    if(fileExt == 'dat'){
      $(this).parents("form").submit();
    }else{
      alert("请选择正确的文件");
    }
  });
  $(function(){
    $('#location').val('{{location}}')
    $("#location").trigger("chosen:updated");

    $('.datetimepicker').datetimepicker({
        autoclose: true,
        todayHighlight: true,
        todayBtn:true,
        minView:2,
        language: 'zh-CN'
    });
    $('#start_date').val('{{start_date}}')
    $('#end_date').val('{{end_date}}')
  })
</script>
{% endblock %}