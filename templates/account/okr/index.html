{% extends "/base.html" %}
{% block title %}我的OKR列表{% endblock %}

{% block content %}
{% include "/account/account_okr_base.html" %}
<style>
    pre {
        background-color:#ffffff;
        border:1px solid #ffffff;
    }
</style>

<div class="container bra-box"  style="width:1300px;">
    <h3>我的OKR列表
        <a class="btn btn-sm btn-default" href="{{url_for('account_okr.create',user_id = g.user.id)}}">填写OKR</a>
    </h3>
    <table class="table table-bordered">
        <tr>
            <th>填写人</th>
            <th>年度</th>
            <th>季度</th>
            <th>状态</th>
            <th style="width:130px;">操作</th>
        </tr>
        {% for l in okrs %}
        <tr>
            <td>{{l.creator.name}}</td>
            <td>{{l.year}}</td>
            <td>{{l.season}}</td>
            <td>{{l.status_cn}}</td>
            <td>
                {% if l.status in [0, 1] %}
                    <a href="{{url_for('account_okr.update', user_id=g.user.id, lid=l.id)}}">修改</a><br/>
                    <a href="{{url_for('account_okr.status', user_id=g.user.id, lid=l.id)}}?status=2">发送申请</a><br>
                    <a href="javascript:check_del('{{url_for('account_okr.delete', user_id=g.user.id, lid=l.id)}}')">删除</a>
                {% elif l.status == 2 %}
                    <a href="{{url_for('account_okr.status', user_id=g.user.id, lid=l.id)}}?status=0">取消请假</a><br/>
                    <a href="{{url_for('account_okr.status', user_id=g.user.id, lid=l.id)}}?status=2">再次发送申请</a>
                {% elif l.status == 4 %}
                    <a href="{{url_for('account_okr.update', user_id=g.user.id, lid=l.id)}}">修改</a><br/>
                    <a href="{{url_for('account_okr.status', user_id=g.user.id, lid=l.id)}}?status=2">发送申请</a><br/>
                    <a href="javascript:check_del('{{url_for('account_okr.delete', user_id=g.user.id, lid=l.id)}}')">删除</a>
                {% endif %}
                {% if g.user.is_super_admin() %}
                    <br/><br/><a href="javascript:check_del('{{url_for('account_okr.delete', user_id=g.user.id, lid=l.id)}}')">删除</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
<script>
function check_del(url){
    if(confirm("确认要删除这条信息吗？")){
        window.location.href = url
    }
}
</script>
{% endblock %}
