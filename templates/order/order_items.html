{% macro items_tab_content(items_info) -%}
<table class="table table-bordered table-hover table-striped table-condensed text-center">
  <tr>
    <th rowspan="2" style="min-width: 40px;">售卖类型</th>
    <th rowspan="2" style="min-width: 80px;">展示位置</th>
    {% for m, m_len in items_info['months'].items() %}
        <th colspan="{{m_len}}" class="text-center">{{m}} 月</th>
    {% endfor %}
    <th rowspan="2" style="min-width: 40px;">刊例价格</th>
    <th rowspan="2">总预订量</th>
  </tr>
  <tr>
    {% for d in items_info['dates'] %}
      {% if d.isoweekday() in [6, 7] %}
      <td class="bg-success">{{d.day}}</td>
      {% else %}
      <td class="bg-info">{{d.day}}</td>
      {% endif %}
    {% endfor %}
  </tr>
  {% for v, sale_type_cn, sale_type_items in items_info['items'] %}
    {% for i in sale_type_items %}
    <tr>
      {% if loop.index == 1 %}
      <td rowspan="{{sale_type_items|length}}" style="vertical-align: middle;">{{sale_type_cn}}</td>
      {% endif %}
      <td><a href="{{url_for('order.item_detail', item_id=i.id)}}">{{i.position.name}}</a></td>
      {% for d in items_info['dates'] %}
        <th>{{i.schedule_by_date(d).num}}</th>
      {% endfor %}
      <td>{{i.position.price}}</td>
      <td>{{i.schedule_sum}}</td>
    </tr>
    {% endfor %}
  {% endfor %}
</table>
{%- endmacro %}

{% macro order_items(order) -%}
<ul class="nav nav-pills" role="tablist">
  {% for status_items_info in order.items_info() %}
  {% if loop.index == 1 %}
  <li role="presentation" class="active"><a href="#tab-{{loop.index}}" role="tab" data-toggle="tab">{{status_items_info['status_cn']}}</a></li>
  {% else %}
  <li role="presentation"><a href="#tab-{{loop.index}}" role="tab" data-toggle="tab">{{status_items_info['status_cn']}}</a></li>
  {% endif %}
  {% endfor %}
</ul>
<div class="tab-content">
  {% for status_items_info in order.items_info() %}
  {% if loop.index == 1 %}
  <div class="tab-pane fade in active" id="tab-{{loop.index}}" style="overflow-x:auto;overflow-y:hidden;">
    {{ items_tab_content(status_items_info) }}
  </div>
  {% else %}
  <div class="tab-pane fade" id="tab-{{loop.index}}" style="overflow-x:auto;overflow-y:hidden;">
    {{ items_tab_content(status_items_info) }}
  </div>
  {% endif %}
  {% endfor %}
</div>
{%- endmacro %}
