{% macro items_tab_content(items_info) -%}
<table class="table table-bordered table-hover table-striped table-condensed text-center">
  <thead>
    <tr>
      <th rowspan="2" style="min-width: 40px;">售卖类型</th>
      <th rowspan="2" style="min-width: 40px;" class="text-center">
        <input type="checkbox" class="checkbox_all">
      </th>
      <th rowspan="2" style="min-width: 80px;">展示位置</th>
      {% for m, m_len in items_info['months'].items() %}
          <th colspan="{{m_len}}" class="text-center">{{m}} 月</th>
      {% endfor %}
      <th rowspan="2" style="min-width: 40px;">刊例价格</th>
      <th rowspan="2">总预订量</th>
    </tr>
    <tr>
      {% for d in items_info['dates'] %}
        {% if d.isoweekday() in [6, 7] %}
        <td class="bg-success">{{d.day}}</td>
        {% else %}
        <td class="bg-info">{{d.day}}</td>
        {% endif %}
      {% endfor %}
    </tr>
  </thead>
  </tbody>
    {% for v, sale_type_cn, sale_type_items in items_info['items'] %}
      {% for i in sale_type_items %}
      <tr>
        {% if loop.index == 1 %}
        <td rowspan="{{sale_type_items|length}}" style="vertical-align: middle;">{{sale_type_cn}}</td>
        {% endif %}
        <td>
          <input type="checkbox" class="checkbox_one" name="item_id" value="{{i.id}}">
        </td>
        <td><a href="{{url_for('order.item_detail', item_id=i.id)}}">{{i.position.name}}</a></td>
        {% for d in items_info['dates'] %}
          <th>{{i.schedule_by_date(d).num}}</th>
        {% endfor %}
        <td>{{i.position.price}}</td>
        <td>{{i.schedule_sum}}</td>
      </tr>
      {% endfor %}
    {% endfor %}
  </tbody>
</table>
{%- endmacro %}

{% macro button_by_action(action) -%}
  <button class="btn btn-sm btn-primary" type="submit" name="action" value="{{action}}">{{action | item_status_action_cn}}</button>
{%- endmacro %}

{% macro order_items(order) -%}
<ul class="nav nav-pills" role="tablist">
  <li role="presentation" class="active"><a href="#tab-0" role="tab" data-toggle="tab">新建</a></li>
  <li role="presentation"><a href="#tab-1" role="tab" data-toggle="tab">预下单</a></li>
  <li role="presentation"><a href="#tab-2" role="tab" data-toggle="tab">预下单(通过)</a></li>
  <li role="presentation"><a href="#tab-3" role="tab" data-toggle="tab">下单(待审核)</a></li>
  <li role="presentation"><a href="#tab-4" role="tab" data-toggle="tab">已下单</a></li>
</ul>
<div class="tab-content">
  <div class="tab-pane fade in active" id="tab-0" style="overflow-x:auto;overflow-y:hidden;">
    <form action="{{url_for('order.items_status_update', order_id=order.id)}}" method="POST">
      {{ items_tab_content(order.items_info_by_status(0)) }}
      <div>
        {{ button_by_action(0) }}
      </div>
    </form>
  </div>
  <div class="tab-pane fade" id="tab-1" style="overflow-x:auto;overflow-y:hidden;">
    <form action="{{url_for('order.items_status_update', order_id=order.id)}}" method="POST">
      {{ items_tab_content(order.items_info_by_status(1)) }}
      <div>
        {{ button_by_action(1) }}
        {{ button_by_action(2) }}
      </div>
    </form>
  </div>
  <div class="tab-pane fade" id="tab-2" style="overflow-x:auto;overflow-y:hidden;">
    <form action="{{url_for('order.items_status_update', order_id=order.id)}}" method="POST">
      {{ items_tab_content(order.items_info_by_status(2)) }}
      <div>
        {{ button_by_action(3) }}
      </div>
    </form>
  </div>
  <div class="tab-pane fade" id="tab-3" style="overflow-x:auto;overflow-y:hidden;">
    <form action="{{url_for('order.items_status_update', order_id=order.id)}}" method="POST">
      {{ items_tab_content(order.items_info_by_status(3)) }}
      <div>
        {{ button_by_action(4) }}
        {{ button_by_action(5) }}
      </div>
    </form>
  </div>
  <div class="tab-pane fade" id="tab-4" style="overflow-x:auto;overflow-y:hidden;">
    <form action="{{url_for('order.items_status_update', order_id=order.id)}}" method="POST">
      {{ items_tab_content(order.items_info_by_status(4)) }}
    </form>
  </div>

</div>
{%- endmacro %}
