{% from 'form.html' import form_field %}
{% macro order_contract_form(order) -%}
<form class="form form-horizontal" method="POST">
  {% if g.user.is_contract() %}
  <input class="hide" name="info_type" value="2"/>
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">合同号申请状态 : </label>
    <div class="col-sm-10">
        <label style="height: 34px; padding: 6px 12px;">{{order.contract_status_cn}}</label>
    </div>
  </div>
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">客户订单合同号 : </label>
    <div class="col-sm-10">
        <input class="form-control bra-form-control" name="client_contract" type="text" value="{{order.contract}}"/>
        <button class="btn btn-sm btn-default btn-generator" data-contract="{{order.get_default_contract()}}">生成</button>
    </div>
  </div>
  {% for mo in order.medium_orders %}
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">[{{mo.medium.name}}]合同号 : </label>
    <div class="col-sm-10">
      <input class="form-control bra-form-control" name="medium_contract_{{mo.id}}"type="text" value="{{mo.medium_contract}}"/>
    </div>
  </div>
  {% endfor %}
  <input type="submit" class="btn btn-primary btn-sm col-md-offset-2" value="保存"/>
  {% else %}
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">合同号申请状态 : </label>
    <div class="col-sm-10">
        <label style="height: 34px; padding: 6px 12px;">{{order.contract_status_cn}}</label>
    </div>
  </div>
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">客户订单合同号 : </label>
    <div class="col-sm-10">
        <label style="height: 34px; padding: 6px 12px;">{{order.contract}}</label>
    </div>
  </div>
  {% for mo in order.medium_orders %}
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">[{{mo.medium.name}}]合同号 : </label>
    <div class="col-sm-10">
        <label style="height: 34px; padding: 6px 12px;">{{mo.medium_contract}}</label>
    </div>
  </div>
  {% endfor %}
  {% endif %}
</form>
<br><br>
<div class="col-md-8">
  <form class="form form-horizontal" id="contract-form" method="POST" action="{{url_for('order.order_contract', order_id=order.id)}}">
    <div class="form-group">
        <label for="email" class="col-sm-2 control-label">提醒邮箱 : </label>
        <div class="col-sm-10">
            <input class="form-control bra-form-control" id="contract-email"
            name="email" value="" placeholder="请输入需要提醒人员的邮箱, 逗号分隔"/>
        </div>
    </div>
    <div class="form-group">
        <label for="msg" class="col-sm-2 control-label">留言 : </label>
        <div class="col-sm-10">
            <textarea class="form-control bra-form-control" id="msg"
            name="msg" rows="4" placeholder="请输入需要附加在邮件中的留言..."></textarea>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">操作 : </label>
        <div class="col-sm-10">
            {% if order.can_admin(g.user) %}
            <button class="btn btn-sm btn-primary contract-submit" type="submit" name="action" value="0">申请合同号</button>
            <button class="btn btn-sm btn-primary contract-submit" type="submit" name="action" value="1">申请打印</button>
            {% endif %}
            {% if g.user.is_leader() %}
            <button class="btn btn-sm btn-primary contract-submit" type="submit" name="action" value="2">申请通过</button>
            <button class="btn btn-sm btn-warning contract-submit" type="submit" name="action" value="3">申请拒绝</button>
            {% endif %}
            {% if g.user.is_contract() %}
            <button class="btn btn-sm btn-primary contract-submit" type="submit" name="action" value="4">打印完毕</button>
            {% endif %}
        </div>
    </div>
  </form>
</div>
<script>
 $(".contract-submit").click(function(e){
   var actionVal = $(this).val();
   var email = $("#contract-email").val();
   var msg = $("#msg").val();
   if(actionVal == '0' || actionVal == '1'){
     if(email == "" || msg == ""){
         e.preventDefault();
         alert("请填写通知邮箱或者申请理由！");
     }
   }else if(actionVal == '3'){
     if(msg == ""){
         e.preventDefault();
         alert("请填写拒绝理由！");
      }
   }
 });
 $(".btn-generator").click(function(e){
      e.preventDefault();
      $(this).parent().find("input").val($(this).data("contract"));
 });
</script>
{%- endmacro %}
