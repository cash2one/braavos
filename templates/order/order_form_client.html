{% from 'form.html' import form_field %}
{% macro order_client_form(form, mediums=None) -%}
<form class="form form-horizontal" method="POST">
    <input class="hide" name="info_type" value="0"/>
    {{form.csrf_token}}
    {{ form_field(form.agent) }}
    {{ form_field(form.client) }}
    {{ form_field(form.campaign) }}
    {{ form_field(form.money) }}
    <div class="form-group">
      <label for="client_start" class="col-sm-2 control-label">执行开始 : </label>
      <div class="col-sm-4">
        <input type="text" id="client_start" name="client_start" value="{{form.client_start.data}}" class="datetimepicker form-control bra-form-control" data-date-format="yyyy-mm-dd">
      </div>
    </div>
    <div class="form-group">
      <label for="client_end" class="col-sm-2 control-label">执行结束 : </label>
      <div class="col-sm-4">
        <input type="text" id="client_end" name="client_end" value="{{form.client_end.data}}" class="datetimepicker form-control bra-form-control" data-date-format="yyyy-mm-dd">
      </div>
    </div>
    <div class="form-group">
      <label for="reminde_date" class="col-sm-2 control-label">回款日期 : </label>
      <div class="col-sm-4">
        <input type="text" id="reminde_date" name="reminde_date" value="{{form.reminde_date.data}}" class="datetimepicker form-control bra-form-control" data-date-format="yyyy-mm-dd">
      </div>
    </div>
    {{ form_field(form.direct_sales) }}
    {{ form_field(form.agent_sales) }}
    {{ form_field(form.contract_type) }}
    {{ form_field(form.resource_type) }}
    {{ form_field(form.sale_type) }}
    {% if mediums %}
    <hr/>
    <div id="mediums">
    </div>
    <button class="btn btn-sm btn-default add-new-medium"><span class="glyphicon glyphicon-plus"></span>  投放媒体 </button>
    {% endif %}
    <hr/>
    <input type="submit" class="btn btn-primary btn-sm col-md-offset-2" value="保存"/>
</form>

{% if mediums %}
<script type="txt/template" id="medium-tpl">
  <div class="form-group">
    <label class="medium-control">媒体 : </label>
    <select name="medium" type="text" class="form-control medium-control">
      {% for m in mediums %}
        <option value="{{m[0]}}">{{m[1]}}</option>
      {% endfor %}
    </select>
    <label class="medium-control">售卖金额(元) : </label>
    <input name="medium-money" type="text" class="form-control medium-control" placeholder="售卖金额(元)" value="0"/>
    <button class="btn btn-sm btn-default medium-remove"> 取消 </button>
  </div>
</script>
<style>
  .medium-control{margin-right: 10px; text-align: right; width:20%; display: inline-block;}
</style>
{% endif %}
<script>
$(document).ready(function(){
    $('.datetimepicker').datetimepicker({
        autoclose: true,
        todayHighlight: true,
        language: 'zh-CN',
        minView: 2
      });
    $(".add-new-medium").click(function(e){
      e.preventDefault();
      var medium_tpl = $("#medium-tpl").html();
      $(this).parents("form").find("#mediums").append(medium_tpl);
      $(".medium-remove").click(function(e){
        e.preventDefault();
        $(this).parents(".form-group").remove();
      });
    });
    $("#client_end").change(function(e){
      var endDate = new Date($('#client_end').val());
      endDate.setDate(endDate.getDate() + 90); 
      $('#reminde_date').val(endDate.getFullYear()+"-"+(endDate.getMonth()+1)+"-"+endDate.getDate())
    });
});
</script>
{%- endmacro %}
