{% extends "/base.html" %}
{% block title %}外包详情{% endblock %}
{% block content %}
{% include "/data_query/data_query_base.html" %}
<div class="container bra-box" style="width:2800px;">
    <h3>外包详情</h3>
    <div class="search">
        <form class="form-inline" role="form" action="" method='get'>
        <div class="form-group">
            <select class="form-control" name="year" id="year" placeholder="选择执行年" style="width:150px;">
                {% for k in range(10) %}
                <option value="{{2014+k}}">{{2014+k}}</option>
                {% endfor %}
            </select>
        </div>
        <input type="submit" value="查询" class="btn btn-sm btn-info" >
        <input type="button" value="导出Excel" class="btn btn-sm btn-default" onclick="javascript:download();">
        </form>
    </div>
    <br>
    <table class="table table-bordered">
        <tr>
            <th colspan=7 >合同信息</th>
            <th colspan=7 >项目成本Q1</th>
            <th colspan=7 >项目成本Q2</th>
            <th colspan=7 >项目成本Q3</th>
            <th colspan=7 >项目成本Q4</th>
        </tr>
        <tr>
            <th>项目合同号</th>
            <th>项目名称</th>
            <th>项目金额</th>
            <th>大区</th>
            <th>应付小计</th>
            <th>所占比重</th>
            <th>实付金额</th>
            {% for k in range(1,5) %}
            <th>奖品</th>
            <th>Flash</th>
            <th>劳务(KOL、线下活动等)</th>
            <th>效果优化</th>
            <th>其他(视频等)</th>
            <th>flash&H5开发</th>
            <th>H5开发</th>
            {% endfor %}
        </tr>
        {% for k in  orders %}
        <tr>
            <td>{{k.contract or "无合同号"}}</td>
            <td>{{k.campaign}}</td>
            <td>{{k.money|format_price}}</td>
            <td>{{k.locations_cn}}</td>
            <td>{{k.outsources_sum|format_price}}</td>
            <td>{{k.outsources_percent}}%</td>
            <td>{{k.outsources_paied_sum|format_price}}</td>
            {% for i in k.o_money %}
                <td>{{i|format_price}}</td>
            {% endfor %}
        </tr>
        {% endfor %}
        <tr>
            <th colspan=4>合计</th>
            <th>{{r_outsource_pay|format_price}}</th>
            <th></th>
            <th>{{orders|sum(attribute='outsources_paied_sum')|format_price}}</th>
            <td colspan=28>{{total|format_price}}</td>
        </tr>
    </table>
</div>

<script>
    $(function(){
        $("#year").val("{{now_year}}")
        $("#year").trigger("chosen:updated");
    })
    function download(){
         window.location.href = window.location.pathname +
          '?year=' + $('#year').val() + '&action=download';
    }
</script>
{% endblock %}
